# Issue: Create workflow test runner

## Overview
# Issue #001.2: Create workflow test runner

## Overview
Create a comprehensive test script that uses the validation framework to test the complete PRD workflow: creation, parsing, and epic generation.

## Files to Modify
1. `.claude/scripts/cccc/test-prd-workflow.sh` (new)

## Implementation Sketch
```bash
#!/bin/bash
# test-prd-workflow.sh - Complete PRD workflow testing

source "$(dirname "$0")/validate-prd.sh"

# Test constants
TEST_PRD="test-prd-validation"
TEST_DIR=$(mktemp -d)
ORIGINAL_DIR=$(pwd)

# Setup test environment
setup_test_environment() {
    echo "üîß Setting up test environment in: $TEST_DIR"
    cd "$TEST_DIR"
    
    # Copy CCCC structure
    cp -r "$ORIGINAL_DIR/.cccc" . 2>/dev/null || mkdir -p .cccc/prds
    cp -r "$ORIGINAL_DIR/.claude" . 2>/dev/null || mkdir -p .claude/commands/cccc/prd
}

# Test PRD creation workflow
test_prd_creation() {
    echo "üìù Testing PRD creation workflow..."
    
    # Run PRD creation command
    local creation_result
    if .claude/commands/cccc/prd/new.md "$TEST_PRD" > /dev/null 2>&1; then
        creation_result=0
    else
        creation_result=1
    fi
    
    report_validation_results "PRD Creation" $creation_result
    
    # Validate created PRD
    validate_prd_exists "$TEST_PRD"
    local exists_result=$?
    
    validate_yaml_frontmatter ".cccc/prds/${TEST_PRD}.md"
    local frontmatter_result=$?
    
    return $(( creation_result + exists_result + frontmatter_result ))
}

# Test PRD parsing workflow
test_prd_parsing() {
    echo "‚öôÔ∏è Testing PRD parsing workflow..."
    
    # Run PRD parsing command
    local parsing_result
    if .claude/commands/cccc/prd/parse.md "$TEST_PRD" > /dev/null 2>&1; then
        parsing_result=0
    else
        parsing_result=1
    fi
    
    report_validation_results "PRD Parsing" $parsing_result
    
    # Validate epic was created
    if [[ -d ".cccc/epics/$TEST_PRD" ]]; then
        echo "‚úÖ Epic directory created"
        epic_result=0
    else
        echo "‚ùå Epic directory not created"
        epic_result=1
    fi
    
    return $(( parsing_result + epic_result ))
}

# Cleanup test environment
cleanup_test_environment() {
    echo "üßπ Cleaning up test environment..."
    cd "$ORIGINAL_DIR"
    rm -rf "$TEST_DIR"
}

# Main test execution
main() {
    echo "üöÄ Starting PRD workflow validation..."
    
    # Setup
    setup_test_environment
    validate_directory_structure "."
    local setup_result=$?
    
    # Run tests
    local creation_result=0
    local parsing_result=0
    
    if [[ $setup_result -eq 0 ]]; then
        test_prd_creation
        creation_result=$?
        
        if [[ $creation_result -eq 0 ]]; then
            test_prd_parsing
            parsing_result=$?
        fi
    fi
    
    # Report final results
    local total_errors=$(( setup_result + creation_result + parsing_result ))
    
    echo ""
    echo "üìä Test Summary:"
    echo "  Setup: $([ $setup_result -eq 0 ] && echo "‚úÖ PASSED" || echo "‚ùå FAILED")"
    echo "  Creation: $([ $creation_result -eq 0 ] && echo "‚úÖ PASSED" || echo "‚ùå FAILED")"
    echo "  Parsing: $([ $parsing_result -eq 0 ] && echo "‚úÖ PASSED" || echo "‚ùå FAILED")"
    echo ""
    
    # Cleanup
    cleanup_test_environment
    
    if [[ $total_errors -eq 0 ]]; then
        echo "üéâ All PRD workflow tests PASSED!"
        return 0
    else
        echo "üí• PRD workflow tests FAILED with $total_errors errors"
        return 1
    fi
}

# Run main function if script is executed directly
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main "$@"
fi
```

## Acceptance Criteria
- [ ] Script tests complete PRD creation workflow
- [ ] Script tests complete PRD parsing workflow
- [ ] Script uses validation framework functions
- [ ] Script provides comprehensive test reporting
- [ ] Script handles test environment setup/cleanup
- [ ] Script returns proper exit codes
- [ ] Script can be run independently or sourced

## Dependencies
- Issue #001.1: Validation framework must be created first

## Definition of Done
- [ ] Code implemented according to implementation sketch
- [ ] All acceptance criteria met
- [ ] Script follows CCCC bash patterns and standards
- [ ] Tests validate the complete PRD workflow end-to-end
- [ ] Ready for error recovery script integration (Issue #004.1)\n\n---\nDepends on #35

## Comments Processing Summary
2025-08-29T02:09:55Z: Updated from platform

### Structured Updates Applied:


**jeunesse.paulien** (2025-08-29T02:03:27.418Z):
mentioned in commit 07eb4560e0187c4fd9e311b0058ff1494985b531

**jeunesse.paulien** (2025-08-29T01:54:17.648Z):
Make sure the `TEST_PRD` is consistent with the rest

**jeunesse.paulien** (2025-08-29T01:53:10.561Z):
mentioned in merge request !4

**jeunesse.paulien** (2025-08-28T04:42:33.044Z):
mentioned in issue #45

**jeunesse.paulien** (2025-08-28T04:42:21.547Z):
mentioned in issue #40


---
*Last updated from platform: 2025-08-29T02:09:55Z*
