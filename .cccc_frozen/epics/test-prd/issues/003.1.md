# Issue: Improve new command validation logic

## Overview
# Issue #003.1: Improve new command validation logic

## Overview
Enhance the PRD new command validation logic to provide comprehensive YAML frontmatter validation, field checking, and improved error messages.

## Files to Modify
1. `.claude/commands/cccc/prd/new.md` (modify)

## Implementation Sketch

Add enhanced validation section to the existing command:

```markdown
## Enhanced Validation Logic

### Validate PRD Name
```bash
# Validate PRD name format
validate_prd_name() {
    local prd_name="$1"
    
    # Check for empty name
    if [[ -z "$prd_name" ]]; then
        echo "‚ùå PRD name cannot be empty"
        return 1
    fi
    
    # Check for valid characters (alphanumeric, dash, underscore)
    if [[ ! "$prd_name" =~ ^[a-zA-Z0-9_-]+$ ]]; then
        echo "‚ùå PRD name contains invalid characters. Use only letters, numbers, dash, underscore"
        return 1
    fi
    
    # Check length (max 50 characters)
    if [[ ${#prd_name} -gt 50 ]]; then
        echo "‚ùå PRD name too long (max 50 characters)"
        return 1
    fi
    
    echo "‚úÖ Valid PRD name: $prd_name"
    return 0
}
```

### Generate Standardized Frontmatter
```bash
# Generate YAML frontmatter with validation
generate_prd_frontmatter() {
    local prd_name="$1"
    local current_time=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
    
    cat <<EOF
---
name: "$prd_name"
status: "draft"
created: "$current_time"
updated: "$current_time"
version: "1.0.0"
author: "CCCC System"
type: "feature"
priority: "medium"
estimated_effort: "TBD"
github: "[Will be updated when synced to GitHub]"
---
EOF
}
```

### Validate Directory Structure
```bash
# Ensure required directories exist
validate_and_create_directories() {
    local required_dirs=(".cccc" ".cccc/prds")
    
    for dir in "${required_dirs[@]}"; do
        if [[ ! -d "$dir" ]]; then
            echo "üìÅ Creating directory: $dir"
            mkdir -p "$dir" || {
                echo "‚ùå Failed to create directory: $dir"
                return 1
            }
        fi
    done
    
    echo "‚úÖ Directory structure validated"
    return 0
}
```

### Check for Existing PRD
```bash
# Check if PRD already exists
check_existing_prd() {
    local prd_name="$1"
    local prd_path=".cccc/prds/${prd_name}.md"
    
    if [[ -f "$prd_path" ]]; then
        echo "‚ö†Ô∏è PRD already exists: $prd_path"
        read -p "Overwrite existing PRD? (yes/no): " confirm
        if [[ "$confirm" != "yes" ]]; then
            echo "‚ùå PRD creation cancelled"
            return 1
        fi
        echo "üîÑ Overwriting existing PRD"
    fi
    
    return 0
}
```
```

## Acceptance Criteria
- [ ] PRD name validation with clear error messages
- [ ] Standardized YAML frontmatter generation
- [ ] Directory structure validation and creation
- [ ] Existing PRD detection with user confirmation
- [ ] All validation functions return proper exit codes
- [ ] Enhanced error messages with emoji indicators
- [ ] Integration with existing command flow

## Dependencies
- Issue #002.1: Template structure must be finalized first

## Definition of Done
- [ ] Code implemented according to implementation sketch
- [ ] All acceptance criteria met
- [ ] Validation logic follows CCCC patterns and standards
- [ ] Enhanced error handling and user feedback
- [ ] Ready for error handling enhancements (Issue #004.2)\n\n---\nDepends on #37

## Comments Processing Summary
2025-08-28T11:37:17Z: Updated from platform

### Structured Updates Applied:


**jeunesse.paulien** (2025-08-28T04:42:33.267Z):
mentioned in issue #45


---
*Last updated from platform: 2025-08-28T11:37:17Z*
